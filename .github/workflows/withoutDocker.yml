# Name of the GitHub Actions workflow
name: Cypress API Tests - WITHOUT DOCKER

# Events that trigger this workflow
on:
  # Run workflow on pushes to the master branch
  push:
    branches: [ master ]

  # Run workflow on pull requests
  pull_request:

jobs:
  # -------------------
  # BUILD JOB
  # -------------------
  build-job:
    runs-on: ubuntu-latest

    steps:
      # Checkout the repository code
      - name: Checkout repo
        uses: actions/checkout@v4

      # Setup Node.js and enable npm cache
      # This cache is shared across jobs in the same workflow
      - name: Setup Node.js (with npm cache)
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      # Install dependencies
      # If cache is hit, npm will reuse downloaded packages
      - name: Install dependencies
        run: npm ci

      # Optional: build step (keep if needed)
      # - name: Build project
      #   run: npm run build

  # -------------------
  # TEST JOB – api-int-1
  # -------------------
  api-int-1:
    runs-on: ubuntu-latest

    # Run only after build-job succeeds
    needs: build-job

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      # Setup Node.js and reuse npm cache
      - name: Setup Node.js (with npm cache)
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      # Install dependencies (fast due to cache)
      - name: Install dependencies
        run: npm ci

      # Run Cypress tests for api-int-1
      - name: Run Cypress tests (api-int-1)
        run: npx cypress run --spec "cypress/e2e/api-int-1/*.cy.{js,ts}"

  # -------------------
  # TEST JOB – api-int-2
  # -------------------
  api-int-2:
    runs-on: ubuntu-latest

    # Run only after build-job succeeds
    needs: build-job

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      # Setup Node.js and reuse npm cache
      - name: Setup Node.js (with npm cache)
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      # Install dependencies (fast due to cache)
      - name: Install dependencies
        run: npm ci

      # Run Cypress tests for api-int-2
      - name: Run Cypress tests (api-int-2)
        run: npx cypress run --spec "cypress/e2e/api-int-2/*.cy.{js,ts}"
